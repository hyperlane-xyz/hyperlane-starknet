#!/bin/bash

# Script to update the FEE_TOKEN address dynamically
# Usage: ./feeToken 0x1234567890abcdef...

if [ $# -eq 0 ]; then
    echo "Usage: $0 <fee_token_address>"
    echo "Example: $0 0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7"
    exit 1
fi

NEW_ADDRESS="$1"

# Validate the address format (basic check for 0x prefix and length)
if [[ ! "$NEW_ADDRESS" =~ ^0x[0-9a-fA-F]{63,64}$ ]]; then
    echo "Error: Invalid address format. Expected hex string starting with 0x"
    exit 1
fi

FEE_TOKEN_FILE="crates/contracts/src/fee_token.cairo"

if [ ! -f "$FEE_TOKEN_FILE" ]; then
    echo "Error: Fee token file not found at $FEE_TOKEN_FILE"
    exit 1
fi

echo "Updating FEE_TOKEN address to: $NEW_ADDRESS"

# Update the fee token address in the file
sed -i.bak "s/0x[0-9a-fA-F]\\{63,64\\}/$NEW_ADDRESS/g" "$FEE_TOKEN_FILE"

if [ $? -eq 0 ]; then
    echo "Successfully updated FEE_TOKEN address in $FEE_TOKEN_FILE"
    rm -f "${FEE_TOKEN_FILE}.bak"  # Remove backup file
else
    echo "Error: Failed to update fee token address"
    exit 1
fi